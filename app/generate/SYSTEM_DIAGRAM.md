# System Architecture Diagram

## Complete Flow: Progressive UI + Error Handling

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           USER INTERACTION                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ Submit Prompt
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND (page.tsx)                             â”‚
â”‚                                                                         â”‚
â”‚  1. Create Progressive Message                                          â”‚
â”‚     â”œâ”€ Initialize ProgressiveMessageManager                             â”‚
â”‚     â”œâ”€ Set phase: "thinking"                                            â”‚
â”‚     â””â”€ Display: "âŸ³ Thought for Xs"                                      â”‚
â”‚                                                                         â”‚
â”‚  2. Stream to Backend API                                               â”‚
â”‚     â””â”€ POST /api/generate-daytona                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ SSE Stream
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        BACKEND (API Route)                              â”‚
â”‚                                                                         â”‚
â”‚  Phase 1: Planning                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Send: { type: "claude_message", content: "I'll create..." }  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                  â”‚                                      â”‚
â”‚  Phase 2: Setup & File Generation                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Send: { type: "progress", message: "Installing deps..." }    â”‚     â”‚
â”‚  â”‚ Send: { type: "tool_use", name: "Write", input: {...} }      â”‚     â”‚
â”‚  â”‚ Send: { type: "tool_use", name: "Write", input: {...} }      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                  â”‚                                      â”‚
â”‚  Phase 3: BUILD VERIFICATION âš ï¸ CRITICAL                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Run: npm run build in sandbox                                 â”‚     â”‚
â”‚  â”‚ Parse: Build output for errors                                â”‚     â”‚
â”‚  â”‚                                                               â”‚     â”‚
â”‚  â”‚ IF ERRORS:                                                    â”‚     â”‚
â”‚  â”‚   Parse error details:                                        â”‚     â”‚
â”‚  â”‚   â”œâ”€ File path                                                â”‚     â”‚
â”‚  â”‚   â”œâ”€ Line/column                                              â”‚     â”‚
â”‚  â”‚   â”œâ”€ Error message                                            â”‚     â”‚
â”‚  â”‚   â””â”€ Generate suggestion                                      â”‚     â”‚
â”‚  â”‚                                                               â”‚     â”‚
â”‚  â”‚   Send: {                                                     â”‚     â”‚
â”‚  â”‚     type: "build_error",                                      â”‚     â”‚
â”‚  â”‚     errors: [{ file, line, message, suggestion }]            â”‚     â”‚
â”‚  â”‚   }                                                           â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                  â”‚                                      â”‚
â”‚  Phase 4: Completion                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Send: {                                                       â”‚     â”‚
â”‚  â”‚   type: "complete",                                           â”‚     â”‚
â”‚  â”‚   previewUrl: "...",                                          â”‚     â”‚
â”‚  â”‚   sandboxId: "...",                                           â”‚     â”‚
â”‚  â”‚   summary: "...",                                             â”‚     â”‚
â”‚  â”‚   issues: errorCount  â† IMPORTANT!                           â”‚     â”‚
â”‚  â”‚ }                                                             â”‚     â”‚
â”‚  â”‚ Send: "[DONE]"                                                â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ SSE Messages
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               FRONTEND: ProgressiveMessageManager                       â”‚
â”‚                                                                         â”‚
â”‚  parseStreamMessage() routes to appropriate handler:                   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ "claude_message" â†’ endThinking(content)                     â”‚       â”‚
â”‚  â”‚ "progress"       â†’ addTask(message)                         â”‚       â”‚
â”‚  â”‚ "tool_use"       â†’ addTask("Created " + filename)           â”‚       â”‚
â”‚  â”‚ "build_error"    â†’ addBuildErrors(errors) âš ï¸ NEW            â”‚       â”‚
â”‚  â”‚ "complete"       â†’ complete(summary, issues)                â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                         â”‚
â”‚  Updates ProgressiveMessageData:                                        â”‚
â”‚  â”œâ”€ phase                                                               â”‚
â”‚  â”œâ”€ tasks[]                                                             â”‚
â”‚  â”œâ”€ files[]                                                             â”‚
â”‚  â”œâ”€ buildErrors[] âš ï¸ NEW                                                â”‚
â”‚  â””â”€ summary                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ State Update
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FRONTEND: ProgressiveMessage                         â”‚
â”‚                                                                         â”‚
â”‚  Renders based on phase:                                                â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ ThinkingIndicator                                           â”‚       â”‚
â”‚  â”‚   "âŸ³ Thought for 3s"                                        â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Planning Statement                                          â”‚       â”‚
â”‚  â”‚   "I'll create your project..."                            â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ TaskList                                                    â”‚       â”‚
â”‚  â”‚   âœ“ Installing dependencies                                 â”‚       â”‚
â”‚  â”‚   âœ“ Created page.tsx                                        â”‚       â”‚
â”‚  â”‚   âŸ³ Creating components...                                  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ ProgressiveFileTree                                         â”‚       â”‚
â”‚  â”‚   ðŸ“ File Tree                                              â”‚       â”‚
â”‚  â”‚     â”œâ”€ page.tsx                                             â”‚       â”‚
â”‚  â”‚     â”œâ”€ globals.css                                          â”‚       â”‚
â”‚  â”‚     â””â”€ ...                                                  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ BuildErrorDisplay âš ï¸ NEW                                    â”‚       â”‚
â”‚  â”‚   âŒ Build Failed - 1 error found                           â”‚       â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚       â”‚
â”‚  â”‚   â”‚ app/globals.css:41:5                              â”‚     â”‚       â”‚
â”‚  â”‚   â”‚                                                   â”‚     â”‚       â”‚
â”‚  â”‚   â”‚ The `hover:shadow-glow/70` class does not exist  â”‚     â”‚       â”‚
â”‚  â”‚   â”‚                                                   â”‚     â”‚       â”‚
â”‚  â”‚   â”‚ ðŸ’¡ Remove opacity modifier or define in config   â”‚     â”‚       â”‚
â”‚  â”‚   â”‚                                                   â”‚     â”‚       â”‚
â”‚  â”‚   â”‚ [Ask AI to Fix Errors]                           â”‚     â”‚       â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ CompletionSummary                                           â”‚       â”‚
â”‚  â”‚   "Your project is ready!"                                  â”‚       â”‚
â”‚  â”‚   âš  1 issue found                                           â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ User Interaction
                                  â–¼
                       [Ask AI to Fix Errors] Button
                                  â”‚
                                  â–¼
                         POST /api/fix-errors
                                  â”‚
                          (Future Implementation)
```

## Component Hierarchy

```
GeneratePageContent
â”œâ”€â”€ Messages Area
â”‚   â””â”€â”€ messages.map()
â”‚       â”œâ”€â”€ UserMessage
â”‚       â”‚   â””â”€â”€ "User prompt text"
â”‚       â”‚
â”‚       â””â”€â”€ ProgressiveMessage â­ Main Component
â”‚           â”œâ”€â”€ ThinkingIndicator
â”‚           â”‚   â””â”€â”€ "âŸ³ Thought for Xs"
â”‚           â”‚
â”‚           â”œâ”€â”€ Planning Statement
â”‚           â”‚   â””â”€â”€ "I'll create..."
â”‚           â”‚
â”‚           â”œâ”€â”€ TaskList
â”‚           â”‚   â””â”€â”€ tasks.map()
â”‚           â”‚       â”œâ”€â”€ Task (pending)
â”‚           â”‚       â”œâ”€â”€ Task (active) âŸ³
â”‚           â”‚       â””â”€â”€ Task (completed) âœ“
â”‚           â”‚
â”‚           â”œâ”€â”€ ProgressiveFileTree
â”‚           â”‚   â””â”€â”€ Progressive file reveals
â”‚           â”‚
â”‚           â”œâ”€â”€ BuildErrorDisplay âš ï¸ NEW
â”‚           â”‚   â””â”€â”€ errors.map()
â”‚           â”‚       â””â”€â”€ ErrorCard
â”‚           â”‚           â”œâ”€â”€ File location
â”‚           â”‚           â”œâ”€â”€ Error message
â”‚           â”‚           â”œâ”€â”€ Suggestion
â”‚           â”‚           â””â”€â”€ Fix button
â”‚           â”‚
â”‚           â””â”€â”€ CompletionSummary
â”‚               â”œâ”€â”€ Summary text
â”‚               â””â”€â”€ Status (âœ“ or âš )
â”‚
â””â”€â”€ Input Area
    â””â”€â”€ Textarea + Send button
```

## Data Flow

```
Backend SSE Message
        â†“
parseStreamMessage()
        â†“
ProgressiveMessageManager
        â†“
updateCallback()
        â†“
setState() in page.tsx
        â†“
ProgressiveMessage component
        â†“
Child components render
        â†“
User sees update
```

## Error Handling Flow

```
1. Backend generates files
        â†“
2. Backend runs: npm run build
        â†“
3. Build fails? â†’ Parse errors
        â†“
4. Send: { type: "build_error", errors: [...] }
        â†“
5. Frontend: parseStreamMessage()
        â†“
6. Manager: addBuildErrors()
        â†“
7. State update with buildErrors[]
        â†“
8. ProgressiveMessage renders BuildErrorDisplay
        â†“
9. User sees:
   âŒ Build Failed - X errors found

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ file.css:41:5               â”‚
   â”‚ Error message here          â”‚
   â”‚ ðŸ’¡ Suggestion here          â”‚
   â”‚ [Ask AI to Fix Errors]      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
10. User clicks fix button
        â†“
11. POST /api/fix-errors with error details
        â†“
12. AI analyzes and fixes errors
        â†“
13. New build verification
        â†“
14. Success! âœ“
```

## Message Type Routing

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Message Type   â”‚   Manager Method    â”‚      UI Component        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ claude_message   â”‚ endThinking()       â”‚ Planning Statement       â”‚
â”‚ progress         â”‚ addTask()           â”‚ TaskList                 â”‚
â”‚ tool_use         â”‚ addTask()           â”‚ TaskList                 â”‚
â”‚ files_generated  â”‚ addFiles()          â”‚ ProgressiveFileTree      â”‚
â”‚ build_error âš ï¸   â”‚ addBuildErrors()    â”‚ BuildErrorDisplay âš ï¸     â”‚
â”‚ complete         â”‚ complete()          â”‚ CompletionSummary        â”‚
â”‚ error            â”‚ (handled directly)  â”‚ Error message            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## File Organization

```
app/generate/
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ThinkingIndicator.tsx       â† Real-time counter
â”‚   â”œâ”€â”€ TaskList.tsx                â† Task progression
â”‚   â”œâ”€â”€ ProgressiveFileTree.tsx     â† File reveals
â”‚   â”œâ”€â”€ CompletionSummary.tsx       â† Final summary
â”‚   â”œâ”€â”€ BuildErrorDisplay.tsx       â† Error display âš ï¸ NEW
â”‚   â”œâ”€â”€ ProgressiveMessage.tsx      â† Main orchestrator
â”‚   â””â”€â”€ DemoProgressiveMessage.tsx  â† Testing component
â”‚
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ progressiveMessageManager.ts â† State manager
â”‚
â”œâ”€â”€ page.tsx                         â† Main page (updated)
â”‚
â””â”€â”€ Documentation/
    â”œâ”€â”€ PROGRESSIVE_UI_GUIDE.md
    â”œâ”€â”€ ERROR_HANDLING_GUIDE.md     âš ï¸ NEW
    â”œâ”€â”€ ERROR_PREVENTION_CHECKLIST.md âš ï¸ NEW
    â”œâ”€â”€ IMPLEMENTATION_SUMMARY.md    âš ï¸ NEW
    â”œâ”€â”€ SYSTEM_DIAGRAM.md           âš ï¸ NEW (this file)
    â””â”€â”€ README.md
```

## Key Integration Points

### 1. Backend â†’ Frontend
```
SSE Stream with proper message format
{
  type: "build_error",
  errors: [{ file, line, message, suggestion }]
}
```

### 2. Frontend State Management
```typescript
const manager = new ProgressiveMessageManager((data) => {
  setMessages(prev => prev.map(msg =>
    msg.id === id ? { ...msg, progressiveData: data } : msg
  ));
});
```

### 3. Error Detection
```typescript
// Backend
const errors = await detectBuildErrors(sandboxId);
if (errors.length > 0) {
  yield { type: "build_error", errors };
}
```

### 4. Error Display
```tsx
// Frontend
{buildErrors && buildErrors.length > 0 && (
  <BuildErrorDisplay errors={buildErrors} />
)}
```

## Summary

The system provides:

âœ… **Progressive UI** - Smooth, sequential reveals like v0
âœ… **Error Detection** - Catches build failures immediately
âœ… **Error Display** - Shows errors with context and suggestions
âœ… **Prevention** - Stops the CSS error you encountered
âœ… **Recovery Path** - "Ask AI to Fix" button (ready for implementation)
âœ… **Professional UX** - Polished, production-ready interface

**The build error (`hover:shadow-glow/70`) that broke your app will now be caught and displayed clearly, allowing the AI to fix it automatically!**
